<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator - Create Stunning Visuals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#06b6d4'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .drag-over {
            border-color: #06b6d4 !important;
            background-color: rgba(6, 182, 212, 0.1) !important;
        }
        
        .image-preview {
            transition: all 0.3s ease;
        }
        
        .image-preview:hover {
            transform: scale(1.05);
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .text-overlay {
            position: absolute;
            cursor: move;
            user-select: none;
            resize: both;
            overflow: hidden;
            min-width: 50px;
            min-height: 20px;
        }
        
        .refinement-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .refinement-panel.open {
            max-height: 500px;
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Header -->
    <header class="glass-effect p-4 mb-8">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold text-white">AI Image Generator</h1>
            <div class="flex space-x-4">
                <button onclick="showGallery()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all">
                    Gallery
                </button>
                <button onclick="showPresets()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all">
                    Presets
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 pb-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel - Controls -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- Step 1: Upload Images -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">📸 Step 1: Upload Images</h2>
                    
                    <div id="dropZone" class="border-2 border-dashed border-white/30 rounded-lg p-8 text-center cursor-pointer hover:border-accent transition-all">
                        <div class="text-white/70 mb-4">
                            <svg class="mx-auto h-12 w-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p>Drag & drop images here or click to browse</p>
                            <p class="text-sm">Supports JPG, PNG, WebP</p>
                        </div>
                        <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
                    </div>
                    
                    <div id="uploadedImages" class="mt-4 grid grid-cols-2 gap-2"></div>
                </div>

                <!-- Step 2: Aspect Ratio -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">📐 Step 2: Aspect Ratio</h2>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="selectAspectRatio('9:16')" class="aspect-ratio-btn bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-all" data-ratio="9:16">
                            Portrait 9:16
                        </button>
                        <button onclick="selectAspectRatio('1:1')" class="aspect-ratio-btn bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-all" data-ratio="1:1">
                            Square 1:1
                        </button>
                        <button onclick="selectAspectRatio('16:9')" class="aspect-ratio-btn bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-all" data-ratio="16:9">
                            Landscape 16:9
                        </button>
                        <button onclick="selectAspectRatio('3:4')" class="aspect-ratio-btn bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-all" data-ratio="3:4">
                            Photo 3:4
                        </button>
                        <button onclick="selectAspectRatio('4:3')" class="aspect-ratio-btn bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-all" data-ratio="4:3">
                            Classic 4:3
                        </button>
                        <button onclick="selectAspectRatio('21:9')" class="aspect-ratio-btn bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-all" data-ratio="21:9">
                            Banner 21:9
                        </button>
                    </div>
                </div>

                <!-- Step 3: Style Selection -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">🎨 Step 3: Style</h2>
                    <div class="space-y-2">
                        <select id="styleCategory" onchange="updateStyleOptions()" class="w-full bg-white/20 text-white rounded-lg p-3 border border-white/30">
                            <option value="birthday">🎂 Birthday</option>
                            <option value="wedding">💒 Wedding</option>
                            <option value="poster">📋 Poster/Flier</option>
                            <option value="cinematic">🎬 Cinematic</option>
                            <option value="pinterest">📌 Pinterest</option>
                            <option value="facebook">📘 Facebook Post</option>
                            <option value="banner">🏷️ Banner</option>
                            <option value="anime">🎌 Anime</option>
                            <option value="cyberpunk">🤖 Cyberpunk</option>
                            <option value="steampunk">⚙️ Steampunk</option>
                            <option value="3d">🎯 3D Render</option>
                            <option value="watercolor">🎨 Watercolor</option>
                        </select>
                        
                        <select id="styleSubtype" class="w-full bg-white/20 text-white rounded-lg p-3 border border-white/30">
                            <option value="card">Card</option>
                            <option value="flier">Flier</option>
                            <option value="poster">Poster</option>
                            <option value="wish">Wish</option>
                        </select>
                    </div>
                </div>

                <!-- Step 4: Background Options -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">🖼️ Step 4: Background</h2>
                    <div class="space-y-3">
                        <button onclick="setBackgroundOption('remove')" class="bg-red-500/80 hover:bg-red-600 text-white w-full p-3 rounded-lg transition-all">
                            Remove Background
                        </button>
                        <button onclick="setBackgroundOption('keep')" class="bg-green-500/80 hover:bg-green-600 text-white w-full p-3 rounded-lg transition-all">
                            Keep Original Background
                        </button>
                        <button onclick="setBackgroundOption('generate')" class="bg-blue-500/80 hover:bg-blue-600 text-white w-full p-3 rounded-lg transition-all">
                            Generate New Background
                        </button>
                    </div>
                </div>

                <!-- Step 5: Concept Generation -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">💡 Step 5: Concept</h2>
                    <div class="space-y-3">
                        <button onclick="generateConcept()" class="bg-purple-500/80 hover:bg-purple-600 text-white w-full p-3 rounded-lg transition-all">
                            Auto-Generate Creative Prompt
                        </button>
                        <textarea id="conceptPrompt" placeholder="Or write your own concept/prompt..." class="w-full bg-white/20 text-white rounded-lg p-3 border border-white/30 h-24 resize-none placeholder-white/50"></textarea>
                        <input type="text" id="topicInput" placeholder="Topic for prompt generation..." class="w-full bg-white/20 text-white rounded-lg p-3 border border-white/30 placeholder-white/50">
                    </div>
                </div>

                <!-- Generate Button -->
                <button onclick="generateImage()" class="w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/80 hover:to-secondary/80 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    ✨ Generate Image
                </button>
            </div>

            <!-- Center Panel - Preview & Results -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Preview Area -->
                <div class="glass-effect rounded-xl p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-white">🖼️ Preview & Results</h2>
                        <div class="flex space-x-2">
                            <button onclick="toggleRefinementPanel()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all">
                                Refine
                            </button>
                            <button onclick="generateVariation()" class="bg-accent/80 hover:bg-accent text-white px-4 py-2 rounded-lg transition-all">
                                Variation
                            </button>
                        </div>
                    </div>
                    
                    <div id="previewArea" class="relative bg-white/10 rounded-lg min-h-96 flex items-center justify-center">
                        <div class="text-white/50 text-center">
                            <svg class="mx-auto h-16 w-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p>Generated images will appear here</p>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id="loadingIndicator" class="hidden text-center py-8">
                        <div class="loading-spinner mx-auto h-8 w-8 border-4 border-white/30 border-t-white rounded-full"></div>
                        <p class="text-white mt-4">Generating your image...</p>
                    </div>
                </div>

                <!-- Refinement Panel -->
                <div id="refinementPanel" class="refinement-panel glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">🎛️ Refinement Tools</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Text Overlay -->
                        <div>
                            <h4 class="text-white font-medium mb-2">Text Overlay</h4>
                            <input type="text" id="overlayText" placeholder="Enter text..." class="w-full bg-white/20 text-white rounded-lg p-2 border border-white/30 placeholder-white/50 mb-2">
                            <div class="grid grid-cols-3 gap-2">
                                <select id="textAlign" class="bg-white/20 text-white rounded p-2 border border-white/30">
                                    <option value="left">Left</option>
                                    <option value="center">Center</option>
                                    <option value="right">Right</option>
                                </select>
                                <input type="range" id="fontSize" min="12" max="72" value="24" class="col-span-2">
                            </div>
                        </div>
                        
                        <!-- Lighting -->
                        <div>
                            <h4 class="text-white font-medium mb-2">Lighting</h4>
                            <div class="space-y-2">
                                <input type="range" id="brightness" min="0" max="200" value="100" class="w-full">
                                <input type="range" id="contrast" min="0" max="200" value="100" class="w-full">
                                <input type="range" id="saturation" min="0" max="200" value="100" class="w-full">
                            </div>
                        </div>
                        
                        <!-- AI Suggestions -->
                        <div class="md:col-span-2">
                            <h4 class="text-white font-medium mb-2">AI Refinement Suggestions</h4>
                            <div id="aiSuggestions" class="flex flex-wrap gap-2">
                                <button onclick="applySuggestion('enhance-colors')" class="bg-blue-500/60 hover:bg-blue-500/80 text-white px-3 py-1 rounded-full text-sm transition-all">
                                    Enhance Colors
                                </button>
                                <button onclick="applySuggestion('add-glow')" class="bg-purple-500/60 hover:bg-purple-500/80 text-white px-3 py-1 rounded-full text-sm transition-all">
                                    Add Glow Effect
                                </button>
                                <button onclick="applySuggestion('sharpen')" class="bg-green-500/60 hover:bg-green-500/80 text-white px-3 py-1 rounded-full text-sm transition-all">
                                    Sharpen Details
                                </button>
                                <button onclick="applySuggestion('vintage')" class="bg-yellow-500/60 hover:bg-yellow-500/80 text-white px-3 py-1 rounded-full text-sm transition-all">
                                    Vintage Filter
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between mt-6">
                        <button onclick="savePreset()" class="bg-green-500/80 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
                            Save Preset
                        </button>
                        <button onclick="applyRefinements()" class="bg-primary hover:bg-primary/80 text-white px-6 py-2 rounded-lg transition-all">
                            Apply Changes
                        </button>
                    </div>
                </div>

                <!-- Download & Actions -->
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">💾 Download & Actions</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <button onclick="downloadImage('png')" class="bg-blue-500/80 hover:bg-blue-600 text-white p-3 rounded-lg transition-all">
                            Download PNG
                        </button>
                        <button onclick="downloadImage('jpg')" class="bg-green-500/80 hover:bg-green-600 text-white p-3 rounded-lg transition-all">
                            Download JPG
                        </button>
                        <button onclick="upscaleImage()" class="bg-purple-500/80 hover:bg-purple-600 text-white p-3 rounded-lg transition-all">
                            Upscale 2x
                        </button>
                        <button onclick="saveToGallery()" class="bg-accent/80 hover:bg-accent text-white p-3 rounded-lg transition-all">
                            Save to Gallery
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="galleryModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-xl p-6 max-w-4xl w-full max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">🖼️ Your Gallery</h2>
                <button onclick="closeGallery()" class="text-white hover:text-gray-300 text-2xl">&times;</button>
            </div>
            <div id="galleryGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Gallery items will be populated here -->
            </div>
        </div>
    </div>

    <!-- Presets Modal -->
    <div id="presetsModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-xl p-6 max-w-2xl w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">⚙️ Presets</h2>
                <button onclick="closePresets()" class="text-white hover:text-gray-300 text-2xl">&times;</button>
            </div>
            <div id="presetsList" class="space-y-3">
                <!-- Presets will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Global state
        let uploadedFiles = [];
        let selectedAspectRatio = '1:1';
        let selectedStyle = { category: 'birthday', subtype: 'card' };
        let backgroundOption = 'keep';
        let generatedImages = [];
        let currentImageIndex = 0;
        let refinementHistory = [];
        let savedPresets = JSON.parse(localStorage.getItem('aiImagePresets') || '[]');
        let gallery = JSON.parse(localStorage.getItem('aiImageGallery') || '[]');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateStyleOptions();
            loadGallery();
            loadPresets();
        });

        function setupEventListeners() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');

            // Drag and drop functionality
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);
            fileInput.addEventListener('change', handleFileSelect);

            // Text overlay functionality
            document.getElementById('overlayText').addEventListener('input', updateTextOverlay);
            document.getElementById('textAlign').addEventListener('change', updateTextOverlay);
            document.getElementById('fontSize').addEventListener('input', updateTextOverlay);

            // Lighting controls
            document.getElementById('brightness').addEventListener('input', updateLighting);
            document.getElementById('contrast').addEventListener('input', updateLighting);
            document.getElementById('saturation').addEventListener('input', updateLighting);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        function processFiles(files) {
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    uploadedFiles.push(file);
                    displayUploadedImage(file);
                }
            });
        }

        function displayUploadedImage(file) {
            const container = document.getElementById('uploadedImages');
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const div = document.createElement('div');
                div.className = 'relative group';
                div.innerHTML = `
                    <img src="${e.target.result}" class="w-full h-20 object-cover rounded-lg image-preview">
                    <button onclick="removeUploadedImage(${uploadedFiles.length - 1})" 
                            class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                        ×
                    </button>
                `;
                container.appendChild(div);
            };
            
            reader.readAsDataURL(file);
        }

        function removeUploadedImage(index) {
            uploadedFiles.splice(index, 1);
            const container = document.getElementById('uploadedImages');
            container.innerHTML = '';
            uploadedFiles.forEach(file => displayUploadedImage(file));
        }

        function selectAspectRatio(ratio) {
            selectedAspectRatio = ratio;
            document.querySelectorAll('.aspect-ratio-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'bg-white/20');
                btn.classList.add('bg-white/20');
            });
            document.querySelector(`[data-ratio="${ratio}"]`).classList.remove('bg-white/20');
            document.querySelector(`[data-ratio="${ratio}"]`).classList.add('bg-primary');
        }

        function updateStyleOptions() {
            const category = document.getElementById('styleCategory').value;
            const subtypeSelect = document.getElementById('styleSubtype');
            
            const options = {
                birthday: ['card', 'flier', 'poster', 'wish'],
                wedding: ['card', 'flier', 'poster', 'wish'],
                poster: ['with text', 'without text', 'minimal', 'detailed'],
                cinematic: ['dramatic', 'soft', 'noir', 'vibrant'],
                pinterest: ['image', 'gif', 'quotes', 'infographic'],
                facebook: ['image post', 'quote post', 'story', 'cover'],
                banner: ['web banner', 'social banner', 'promotional', 'minimalist'],
                anime: ['manga style', 'chibi', 'realistic anime', 'studio ghibli'],
                cyberpunk: ['neon', 'dark', 'futuristic', 'retro'],
                steampunk: ['victorian', 'industrial', 'brass', 'mechanical'],
                '3d': ['realistic', 'stylized', 'low poly', 'high detail'],
                watercolor: ['soft', 'vibrant', 'abstract', 'realistic']
            };

            subtypeSelect.innerHTML = '';
            options[category].forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option.charAt(0).toUpperCase() + option.slice(1);
                subtypeSelect.appendChild(optionElement);
            });

            selectedStyle.category = category;
            selectedStyle.subtype = options[category][0];
        }

        function setBackgroundOption(option) {
            backgroundOption = option;
            document.querySelectorAll('[onclick^="setBackgroundOption"]').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-white');
            });
            event.target.classList.add('ring-2', 'ring-white');
        }

        async function generateConcept() {
            const style = selectedStyle;
            const aspectRatio = selectedAspectRatio;
            const topic = document.getElementById('topicInput').value;
            
            // Simulate AI concept generation
            const concepts = {
                birthday: [
                    "A vibrant celebration scene with colorful balloons, confetti, and warm lighting creating a joyful atmosphere perfect for birthday wishes",
                    "Elegant birthday design with golden accents, soft pastels, and dreamy bokeh effects that capture the magic of special moments",
                    "Fun and playful birthday theme with cartoon elements, bright colors, and festive decorations that bring smiles and happiness"
                ],
                wedding: [
                    "Romantic wedding scene with soft florals, elegant typography, and dreamy lighting that captures the beauty of eternal love",
                    "Classic wedding design with vintage elements, lace patterns, and warm golden tones creating timeless elegance",
                    "Modern wedding aesthetic with clean lines, minimalist florals, and sophisticated color palette for contemporary couples"
                ],
                cinematic: [
                    "Dramatic cinematic composition with moody lighting, deep shadows, and rich colors that tell a compelling visual story",
                    "Epic movie poster style with dynamic angles, bold typography, and atmospheric effects that capture audience attention",
                    "Film noir inspired design with high contrast, dramatic lighting, and mysterious atmosphere for sophisticated storytelling"
                ]
            };
            
            let selectedConcepts = concepts[style.category] || concepts.birthday;
            let concept = selectedConcepts[Math.floor(Math.random() * selectedConcepts.length)];
            
            if (topic) {
                concept = `${concept} incorporating themes of ${topic} with professional studio quality and attention to detail`;
            }
            
            document.getElementById('conceptPrompt').value = concept;
        }

        async function generateImage() {
            if (uploadedFiles.length === 0) {
                alert('Please upload at least one image first!');
                return;
            }

            const loadingIndicator = document.getElementById('loadingIndicator');
            const previewArea = document.getElementById('previewArea');
            
            loadingIndicator.classList.remove('hidden');
            previewArea.innerHTML = '';

            try {
                // Simulate API calls to Gemini and Nano Banana
                await simulateImageGeneration();
                
                // Display generated image
                displayGeneratedImage();
                
            } catch (error) {
                console.error('Generation failed:', error);
                alert('Image generation failed. Please try again.');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        async function simulateImageGeneration() {
            // Simulate processing time
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // Create a simulated generated image
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size based on aspect ratio
            const [width, height] = getCanvasDimensions(selectedAspectRatio);
            canvas.width = width;
            canvas.height = height;
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, width, height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // Add some visual elements
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            for (let i = 0; i < 20; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * width, Math.random() * height, Math.random() * 50, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Add text
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('AI Generated Image', width / 2, height / 2);
            ctx.font = '16px Arial';
            ctx.fillText(`${selectedStyle.category} - ${selectedAspectRatio}`, width / 2, height / 2 + 40);
            
            const imageData = canvas.toDataURL('image/png');
            generatedImages.push({
                data: imageData,
                timestamp: Date.now(),
                style: selectedStyle,
                aspectRatio: selectedAspectRatio,
                prompt: document.getElementById('conceptPrompt').value
            });
        }

        function getCanvasDimensions(ratio) {
            const ratios = {
                '9:16': [450, 800],
                '1:1': [600, 600],
                '16:9': [800, 450],
                '3:4': [600, 800],
                '4:3': [800, 600],
                '21:9': [840, 360]
            };
            return ratios[ratio] || [600, 600];
        }

        function displayGeneratedImage() {
            const previewArea = document.getElementById('previewArea');
            const latestImage = generatedImages[generatedImages.length - 1];
            
            previewArea.innerHTML = `
                <div class="relative w-full h-full flex items-center justify-center">
                    <img src="${latestImage.data}" class="max-w-full max-h-full rounded-lg shadow-lg fade-in" id="generatedImage">
                    <div class="absolute top-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm">
                        ${selectedAspectRatio}
                    </div>
                </div>
            `;
            
            currentImageIndex = generatedImages.length - 1;
        }

        function generateVariation() {
            if (generatedImages.length === 0) {
                alert('Generate an image first!');
                return;
            }
            
            // Create a variation of the current image
            generateImage();
        }

        function toggleRefinementPanel() {
            const panel = document.getElementById('refinementPanel');
            panel.classList.toggle('open');
        }

        function updateTextOverlay() {
            const text = document.getElementById('overlayText').value;
            const align = document.getElementById('textAlign').value;
            const fontSize = document.getElementById('fontSize').value;
            
            if (!text) return;
            
            const previewArea = document.getElementById('previewArea');
            let overlay = previewArea.querySelector('.text-overlay');
            
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'text-overlay bg-black/50 text-white p-2 rounded';
                overlay.style.top = '50%';
                overlay.style.left = '50%';
                overlay.style.transform = 'translate(-50%, -50%)';
                previewArea.appendChild(overlay);
                
                // Make draggable
                makeDraggable(overlay);
            }
            
            overlay.textContent = text;
            overlay.style.textAlign = align;
            overlay.style.fontSize = fontSize + 'px';
        }

        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            element.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
                element.style.transform = 'none';
            }
            
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        function updateLighting() {
            const brightness = document.getElementById('brightness').value;
            const contrast = document.getElementById('contrast').value;
            const saturation = document.getElementById('saturation').value;
            
            const image = document.getElementById('generatedImage');
            if (image) {
                image.style.filter = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%)`;
            }
        }

        function applySuggestion(suggestion) {
            const image = document.getElementById('generatedImage');
            if (!image) return;
            
            const effects = {
                'enhance-colors': 'saturate(150%) contrast(110%)',
                'add-glow': 'drop-shadow(0 0 20px rgba(255, 255, 255, 0.5))',
                'sharpen': 'contrast(120%) brightness(105%)',
                'vintage': 'sepia(30%) contrast(90%) brightness(110%)'
            };
            
            image.style.filter = effects[suggestion] || '';
        }

        function savePreset() {
            const name = prompt('Enter preset name:');
            if (!name) return;
            
            const preset = {
                name,
                style: selectedStyle,
                aspectRatio: selectedAspectRatio,
                backgroundOption,
                brightness: document.getElementById('brightness').value,
                contrast: document.getElementById('contrast').value,
                saturation: document.getElementById('saturation').value,
                timestamp: Date.now()
            };
            
            savedPresets.push(preset);
            localStorage.setItem('aiImagePresets', JSON.stringify(savedPresets));
            loadPresets();
            alert('Preset saved successfully!');
        }

        function applyRefinements() {
            const refinement = {
                brightness: document.getElementById('brightness').value,
                contrast: document.getElementById('contrast').value,
                saturation: document.getElementById('saturation').value,
                textOverlay: document.getElementById('overlayText').value,
                timestamp: Date.now()
            };
            
            refinementHistory.push(refinement);
            alert('Refinements applied!');
        }

        function downloadImage(format) {
            if (generatedImages.length === 0) {
                alert('No image to download!');
                return;
            }
            
            const image = generatedImages[currentImageIndex];
            const link = document.createElement('a');
            link.download = `ai-generated-image-${Date.now()}.${format}`;
            link.href = image.data;
            link.click();
        }

        function upscaleImage() {
            if (generatedImages.length === 0) {
                alert('No image to upscale!');
                return;
            }
            
            // Simulate upscaling process
            alert('Upscaling started! This may take a few moments...');
            
            setTimeout(() => {
                alert('Image upscaled successfully! Download the enhanced version.');
            }, 2000);
        }

        function saveToGallery() {
            if (generatedImages.length === 0) {
                alert('No image to save!');
                return;
            }
            
            const image = generatedImages[currentImageIndex];
            gallery.push({
                ...image,
                id: Date.now(),
                name: `Generated ${gallery.length + 1}`
            });
            
            localStorage.setItem('aiImageGallery', JSON.stringify(gallery));
            alert('Image saved to gallery!');
        }

        function showGallery() {
            document.getElementById('galleryModal').classList.remove('hidden');
            loadGallery();
        }

        function closeGallery() {
            document.getElementById('galleryModal').classList.add('hidden');
        }

        function loadGallery() {
            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = '';
            
            if (gallery.length === 0) {
                grid.innerHTML = '<p class="text-white/50 col-span-full text-center py-8">No images in gallery yet</p>';
                return;
            }
            
            gallery.forEach((image, index) => {
                const div = document.createElement('div');
                div.className = 'relative group cursor-pointer';
                div.innerHTML = `
                    <img src="${image.data}" class="w-full h-32 object-cover rounded-lg">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center">
                        <button onclick="loadFromGallery(${index})" class="bg-white text-black px-3 py-1 rounded mr-2">Load</button>
                        <button onclick="deleteFromGallery(${index})" class="bg-red-500 text-white px-3 py-1 rounded">Delete</button>
                    </div>
                    <p class="text-white text-sm mt-1 truncate">${image.name}</p>
                `;
                grid.appendChild(div);
            });
        }

        function loadFromGallery(index) {
            const image = gallery[index];
            generatedImages.push(image);
            currentImageIndex = generatedImages.length - 1;
            displayGeneratedImage();
            closeGallery();
        }

        function deleteFromGallery(index) {
            if (confirm('Delete this image from gallery?')) {
                gallery.splice(index, 1);
                localStorage.setItem('aiImageGallery', JSON.stringify(gallery));
                loadGallery();
            }
        }

        function showPresets() {
            document.getElementById('presetsModal').classList.remove('hidden');
            loadPresets();
        }

        function closePresets() {
            document.getElementById('presetsModal').classList.add('hidden');
        }

        function loadPresets() {
            const list = document.getElementById('presetsList');
            list.innerHTML = '';
            
            if (savedPresets.length === 0) {
                list.innerHTML = '<p class="text-white/50 text-center py-4">No presets saved yet</p>';
                return;
            }
            
            savedPresets.forEach((preset, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white/10 rounded-lg p-4 flex justify-between items-center';
                div.innerHTML = `
                    <div>
                        <h4 class="text-white font-medium">${preset.name}</h4>
                        <p class="text-white/70 text-sm">${preset.style.category} - ${preset.aspectRatio}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="applyPreset(${index})" class="bg-primary hover:bg-primary/80 text-white px-3 py-1 rounded">Apply</button>
                        <button onclick="deletePreset(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function applyPreset(index) {
            const preset = savedPresets[index];
            
            // Apply preset settings
            selectedStyle = preset.style;
            selectedAspectRatio = preset.aspectRatio;
            backgroundOption = preset.backgroundOption;
            
            // Update UI
            document.getElementById('styleCategory').value = preset.style.category;
            updateStyleOptions();
            document.getElementById('styleSubtype').value = preset.style.subtype;
            selectAspectRatio(preset.aspectRatio);
            
            // Apply lighting settings
            document.getElementById('brightness').value = preset.brightness;
            document.getElementById('contrast').value = preset.contrast;
            document.getElementById('saturation').value = preset.saturation;
            
            closePresets();
            alert('Preset applied successfully!');
        }

        function deletePreset(index) {
            if (confirm('Delete this preset?')) {
                savedPresets.splice(index, 1);
                localStorage.setItem('aiImagePresets', JSON.stringify(savedPresets));
                loadPresets();
            }
        }

        // Initialize default aspect ratio selection
        selectAspectRatio('1:1');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98873a17d50426f7',t:'MTc1OTQzOTg1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
